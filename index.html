<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="format-detection" content="telephone=no, address=no, email=no">
    <title>장형석 ᰔ 남채린, 결혼합니다!</title>

    <link rel="icon" href="img/heart.png" type="image/x-icon">

    <!-- Open Graph 태그 -->
    <meta property="og:title" content="장형석 ᰔ 남채린, 결혼합니다!">
    <meta property="og:description" content="2025년 2월 16일 일요일 오전 11시 ...">
    <meta property="og:image" content="img/main.webp"> <!-- 미리보기 이미지 경로 -->
    <meta property="og:url" content="https://장형석남채린결혼힙니다.메인.한국"> <!-- 실제 사이트 URL -->
    
    <script src="inc/script.js" defer></script>
    <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=dew043nbtg"></script>

    <link rel="stylesheet" href="inc/style.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Arvo:ital,wght@0,400;0,700;1,400;1,700&family=Crimson+Text:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&family=Noto+Sans+KR:wght@100..900&family=Single+Day&display=swap" rel="stylesheet">
</head>
<body>
    <div class="animation-container" id="animationContainer">
        <div class="text" id="text1">
        </div>
    </div>
    
    <div class="invitation-content" id="invitationContent">
        <!-- 청첩장 페이지 -->
        <div class="date-title">2025. 2. 16</div>
        <div class="day-title">SUNDAY</div>
        <div class="image-container">
            <div class="wave top">
                <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
                    <defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs>
                    <g class="parallax">
                        <use class="u-1" xlink:href="#gentle-wave" x="48" y="0" fill="rgba(250,250,250,0.7)"></use>
                        <use class="u-2" xlink:href="#gentle-wave" x="48" y="3" fill="rgba(250,250,250,0.5)"></use>
                        <use class="u-3" xlink:href="#gentle-wave" x="48" y="5" fill="rgba(250,250,250,0.3)"></use>
                        <use class="u-4" xlink:href="#gentle-wave" x="48" y="7" fill="rgba(250,250,250,0.2)"></use>
                    </g>
                </svg>
            </div>
            <img src="img/main.webp" alt="메인 이미지" class="main-image">
            <div class="wave bottom">
                <svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto">
                    <defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs>
                    <g class="parallax">
                        <use class="u-1" xlink:href="#gentle-wave" x="48" y="0" fill="rgba(250,250,250,0.7)"></use>
                        <use class="u-2" xlink:href="#gentle-wave" x="48" y="3" fill="rgba(250,250,250,0.5)"></use>
                        <use class="u-3" xlink:href="#gentle-wave" x="48" y="5" fill="rgba(250,250,250,0.3)"></use>
                        <use class="u-4" xlink:href="#gentle-wave" x="48" y="7" fill="rgba(250,250,250,0.2)"></use>
                    </g>
                </svg>
            </div>
        </div>
        <div class="names">장형석&nbsp;<span>ᰔ</span>&nbsp;남채린</div>
        <div class="details">2025년 2월 16일 일요일 오전 11시<br>더 컨벤션 반포 2F, 그랜드볼룸</div>

        <div class="wise-content">
            <p class="title1">INVITATOIN</p>
            <p class="title2">초대합니다</p>
            <p>사랑의 시작을 알리는 특별한 날, 우리가 부부가 됩니다.</p>
            <br>
            <p>서로의 손을 잡고, 새로운 장을 여는 이 순간</p>
            <p>가족과 친구들 앞에서 우리의 사랑을 다짐합니다.</p>
            <br>
            <p>걸어온 길과 앞으로의 꿈을</p>
            <p>여러분과 나누고 싶습니다.</p>
            <br>
            <p>여러분의 따듯한 미소와 축복이 더해져</p>
            <p>이 날이 더욱 특별해질 것입니다.</p>
            <br>
            <p class="acc">부디 이 순간을 함께 간직해 주세요.</p>
            <br>
            <br>
            <div class="image-container">
                <img src="img/main2.webp" alt="메인 이미지" class="main-image">
            </div>
        </div>
        <div class="family-container">
            <p class="parents">장기성·김희숙<span class="connect">의 장남 </span><span class="groom">장형석</span></p>
            <p class="parents">남광희·송귀노미<span class="connect">의 장녀 </span><span class="bride">남채린</span></p>
        </div>
        <div class="calendar-container">
            <p class="date">2025. 2. 16. 오전 11시</p>
            <div class="calendar-grid">
                <div class="day-header">일</div>
                <div class="day-header">월</div>
                <div class="day-header">화</div>
                <div class="day-header">수</div>
                <div class="day-header">목</div>
                <div class="day-header">금</div>
                <div class="day-header">토</div>
        
                <!-- 빈 칸을 추가하여 1일이 토요일부터 시작하도록 조정 -->
                <div class="day"></div>
                <div class="day"></div>
                <div class="day"></div>
                <div class="day"></div>
                <div class="day"></div>
                <div class="day"></div>
                <div class="day">1</div>
                
                <div class="day sunday">2</div>
                <div class="day">3</div>
                <div class="day">4</div>
                <div class="day">5</div>
                <div class="day">6</div>
                <div class="day">7</div>
                <div class="day">8</div>
                <div class="day sunday">9</div>
                <div class="day">10</div>
                <div class="day">11</div>
                <div class="day">12</div>
                <div class="day">13</div>
                <div class="day">14</div>
                <div class="day">15</div>
                <div class="day today">16</div>
                <div class="day">17</div>
                <div class="day">18</div>
                <div class="day">19</div>
                <div class="day">20</div>
                <div class="day">21</div>
                <div class="day">22</div>
                <div class="day sunday">23</div>
                <div class="day">24</div>
                <div class="day">25</div>
                <div class="day">26</div>
                <div class="day">27</div>
                <div class="day">28</div>
            </div>
            <div class="countdown-container">
                <div class="countdown-item">
                    <div class="label">DAYS</div>
                    <div class="number" id="days">102</div>
                </div>
                <div class="separator">:</div>
                <div class="countdown-item">
                    <div class="label">HOUR</div>
                    <div class="number" id="hours">13</div>
                </div>
                <div class="separator">:</div>
                <div class="countdown-item">
                    <div class="label">MIN</div>
                    <div class="number" id="minutes">38</div>
                </div>
                <div class="separator">:</div>
                <div class="countdown-item">
                    <div class="label">SEC</div>
                    <div class="number" id="seconds">21</div>
                </div>
            </div>
            <div class="dday-container">
                <div class="names">
                    장형석&nbsp;<span class="heart">ᰔ</span>&nbsp;남채린 님의 결혼식이 <span class="days" id="days"></span>일 남았습니다.
                </div>
            </div>
        </div>
        <div class="gallery-container">
            <div class="title1">GALLERY</div>
            <div class="title2">우리의 순간</div>
            <div class="gallery" id="gallery">
                <!-- 초기에는 일부만 보이는 이미지 -->
                <img src="img/gallery/1.webp" class="gallery-item">
                <img src="img/gallery/2.webp" class="gallery-item">
                <img src="img/gallery/3.webp" class="gallery-item">
                <img src="img/gallery/4.webp" class="gallery-item">
                <img src="img/gallery/5.webp" class="gallery-item">
                <img src="img/gallery/1.webp" class="gallery-item">
                <img src="img/gallery/2.webp" class="gallery-item">
                <img src="img/gallery/3.webp" class="gallery-item">
                <img src="img/gallery/4.webp" class="gallery-item">
                
                <!-- 나중에 더 보기 버튼을 클릭하면 보여질 이미지 -->
                <img src="img/gallery/1.webp" class="gallery-item hidden">
                <img src="img/gallery/2.webp" class="gallery-item hidden">
                <img src="img/gallery/3.webp" class="gallery-item hidden">
                <!-- 필요에 따라 더 추가 -->
            </div>
            <div class="more-button" id="moreButton">사진 더 보기</div>
        </div>
            
        <!-- Swiper Modal -->
        <div id="swiperModal" class="swiper-modal">
            <div class="swiper">
                <div class="swiper-wrapper">
                    <!-- 슬라이드 이미지가 동적으로 추가됩니다 -->
                </div>
                <!-- 내비게이션 버튼 -->
                <div class="swiper-button-next"></div>
                <div class="swiper-button-prev"></div>
                <!-- 페이지네이션 -->
                <div class="swiper-pagination"></div>
            </div>
            <button class="close-swiper-modal">X</button>
        </div>

        <div class="location-container">
            <p class="title1">LOCATION</p>
            <p class="title2">오시는 길</p>
            <p class="address">
                서울 서초구 사평대로 108<br>
                더 컨벤션 반포 그랜드볼룸 2층
            </p>
            <button class="copy-address-button" data-clipboard-text="서울 서초구 사평대로 108">주소 복사</button>
            
            <!-- 약도 이미지 보기 버튼 -->
            <div class="map-image-button-section">
                <button class="map-image-button" id="toggle-map-button">약도보기</button>
            </div>

            <!-- 약도 이미지 -->
            <div id="map-image-container" style="display: none;">
                <img src="img/map.webp" alt="약도 이미지" class="map-image">
            </div>

            <!-- 네이버 지도 API 삽입 영역 -->
            <div id="naver-map-container">
                <div id="map" class="map-container"></div>
            </div>
            <script>
                var elluce = new naver.maps.LatLng(37.498903, 126.996565)
                var map = new naver.maps.Map('map', {
                  center: new naver.maps.LatLng(37.499363, 126.996565),
                  zoom: 17,
                  minZoom: 12, //지도의 최소 줌 레벨
                  zoomControl: true, //줌 컨트롤의 표시 여부
                  zoomControlOptions: { //줌 컨트롤의 옵션
                      position: naver.maps.Position.TOP_RIGHT
                }});
                var marker = new naver.maps.Marker({
                    position: elluce,
                    map: map
                });
        
                var contentString = [
                    '<div style="background-color: white; border: 1px solid black; border-radius: 8px; padding: 10px; width: 180px; text-align: center; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);">',
                    '   <p style="font-size: 1rem; margin: 0; font-weight: bold;">더컨벤션반포</p>',
                    '   <p style="font-size: 0.8rem; margin: 5px 0 0;">서울 서초구 사평대로 108</p>',
                    '</div>'
                ].join('');
        
                var infowindow = new naver.maps.InfoWindow({
                    content: contentString,
                    maxWidth: 200,
                    backgroundColor: "transparent", // 기본 배경 제거
                    borderWidth: 0, // 기본 테두리 제거
                    disableAnchor: true,
                    // anchorSize: new naver.maps.Size(0, -20), // 말풍선 꼬리 크기 설정
                    pixelOffset: new naver.maps.Point(-100, -60), // 말풍선 전체 위치 조정
                    // anchorAlign: naver.maps.Position.TOP // 말풍선 꼬리 기준 위치 설정
                });
        
                naver.maps.Event.addListener(marker, "click", function(e) {
                    if (infowindow.getMap()) {
                        infowindow.close();
                    } else {
                        infowindow.open(map, marker);
                    }
                });
        
                infowindow.open(map, marker);
            </script>

            <!-- 네비게이션 버튼 -->
            <div class="transport-section">
                <div class="app-buttons">
                    <a href="javascript:naverMap('더컨벤션 반포', 37.498903 ,126.996565)" class="app-button naver-map"><img src="img/ico/navermap.png" alt="네이버지도"> 네이버지도</a>
                    <a href="javascript:tMap('더컨벤션 반포', 37.498903 ,126.996565)" class="app-button tmap"><img src="img/ico/tmap.png" alt="티맵">  티  맵</a>
                    <a href="javascript:kakaoMap('더컨벤션 반포', 37.498903 ,126.996565)" class="app-button kakao-navi"><img src="img/ico/kakaomap.png" alt="카카오지도"> 카카오지도</a>
                </div>
            </div>
            

            <!-- 지하철 정보 -->
            <div class="transport-section">
                <div class="info-header">
                    <img src="img/ico/subway.png" alt="지하철 아이콘" class="icon">
                    <p class="section-title">지하철</p>
                </div>
                <div class="separator"></div>
                <p class="content">
                    신반포역 4번 출구 도보 11분<br>
                    ☆ 셔틀버스 운행 (10분 간격)<br><br>
                    고속터미널역 5번 출구 도보 12분<br>
                    ☆ 셔틀버스 미운행
                </p>
            </div>

            <!-- 버스 정보 -->
            <div class="transport-section">
                <div class="info-header">
                    <img src="img/ico/bus.png" alt="버스 아이콘" class="icon">
                    <p class="section-title">버스</p>
                </div>
                <div class="separator"></div>
                <p class="content">
                    반포종합운동장(서초소방소 방면)<br>
                    142, 서초10, 서초14<br><br>
                    반포종합운동장(삼성래미안 방면)<br>
                    142, 345, 3420, 서초10
                </p>
            </div>

            <!-- 자가용 정보 -->
            <div class="transport-section">
                <div class="info-header">
                    <img src="img/ico/car.png" alt="자가용 아이콘" class="icon">
                    <p class="section-title">자가용</p>
                </div>
                <div class="separator"></div>
                <p class="content">
                    더 컨벤션 반포 검색<br><br>
                    주소 : 서울 서초구 사평대로 108<br>
                           서울 서초구 반포동 107-3<br><br>
                </p>

                
            </div>

            <!-- 주차 정보 -->
            <div class="transport-section">
                <div class="info-header">
                    <img src="img/ico/parking.png" alt="주차 아이콘" class="icon">
                    <p class="section-title">주차안내</p>
                </div>
                <div class="separator"></div>
                <p class="content">
                    건물 내 만차 시 외부주차장으로 주차해주세요.<br><br>
                    <img src="img/ico/parking2.png" alt="주차 아이콘2" class="icon2">
                    반포2동 공영주차장<br>
                    ☆ 반포공영주차장 도보 14분<br><br>
                    <img src="img/ico/parking2.png" alt="주차 아이콘2" class="icon2">
                    서초구민 체육센터 주차장<br>
                    ☆ 도보 12분 / 셔틀버스 미운행<br><br>
                    ※ 주차장 협소하니 대중교통 이용 부탁드립니다.
                </p>
            </div>
        </div>

        <div class="dining-container">
            <p class="title1">DINING GUIDE</p>
            <p class="title2">연회장 안내</p>
            <div class="foodimage-container">
                <img src="img/food.webp" alt="메인 이미지" class="main-image">
            </div>
            <p class="content">
                연회장은 3층과 4층에 배치되어 있으며,<br>
                맛있는 음식과 <strong>주류가 무제한</strong>으로 제공됩니다.<br>
                마음껏 즐겨주시면 저희도 행복한 마음일 것 같습니다.<br>
                감사합니다 :)
            </p>
        </div>              
        
        <div class="account-container">
            <p class="title1">ACCOUNT</p>
            <p class="title2">마음 전하실 곳</p>
        
            <!-- 신랑측 -->
            <div class="account-section groom-side">
                <p class="section-title">신랑측</p>
                <div class="separator"></div>
                <div class="account-item">
                    <p>신랑 <strong>장형석</strong></p>
                    <p>국민 511302-01-317210</p>
                    <button class="copy-account-button" data-clipboard-text="국민 511302-01-317210">복사</button>
                </div>
                <div class="separator"></div>
                <div class="account-item">
                    <p>어머니 <strong>김희숙</strong></p>
                    <p>국민 511302-01-317210</p>
                    <button class="copy-account-button" data-clipboard-text="국민 000000000000000">복사</button>
                </div>
            </div>
        
            <!-- 신부측 -->
            <div class="account-section bride-side">
                <p class="section-title">신부측</p>
                <div class="separator"></div>
                <div class="account-item">
                    <p>신부 <strong>남채린</strong></p>
                    <p>국민 511302-01-317210</p>
                    <button class="copy-account-button" data-clipboard-text="신한 000000000000">복사</button>
                </div>
                <div class="separator"></div>
                <div class="account-item">
                    <p>아버지 <strong>남광희</strong></p>
                    <p>국민 511302-01-317210</p>
                    <button class="copy-account-button" data-clipboard-text="국민 000000000000">복사</button>
                </div>
                <div class="separator"></div>
                <div class="account-item">
                    <p>어머니 <strong>송귀노미</strong></p>
                    <p>국민 511302-01-317210</p>
                    <button class="copy-account-button" data-clipboard-text="신한 0000000000">복사</button>
                </div>
            </div>
        </div>
        
        <div class="guestbook-container">
            <p class="title1">GUEST BOOK</p>
            <p class="title2">방명록</p>
            <button class="add-message-button">축하글 남기기</button>
            <div class="guestbook-entries">
                <!-- 방명록 메시지들이 들어갈 공간 -->
            </div>
        </div>
        <!-- Guestbook Modal -->
        <div id="guestbook-modal" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h2>축하 메시지 남기기</h2>
                <form id="guestbook-form">
                    <label for="name">이름:</label>
                    <input type="text" id="name" name="name" required>
        
                    <label for="password">비밀번호:</label>
                    <input type="password" id="password" name="password" required>
        
                    <label for="message">내용:</label>
                    <textarea id="message" name="message" rows="4" required></textarea>
        
                    <button type="submit" class="submit-button">메시지 남기기</button>
                </form>
            </div>
        </div>

        <!-- 비밀번호 확인 모달 -->
        <div id="password-modal" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h2>비밀번호 확인</h2>
                <form id="password-form">
                    <label for="password-input">비밀번호:</label>
                    <input type="password" id="password-input" required>
                    <button type="submit" class="submit-button">확인</button>
                </form>
            </div>
        </div>

        <!-- 수정 모달 -->
        <div id="edit-modal" class="modal">
            <div class="modal-content">
                <span class="close-button">&times;</span>
                <h2>메시지 수정</h2>
                <form id="edit-form">
                    <label for="edit-message">새 메시지:</label>
                    <textarea id="edit-message" rows="4" required></textarea>
                    <button type="submit" class="submit-button">수정</button>
                </form>
            </div>
        </div>

        <div class="footer-container">
            <div id="toast"></div>
            <div class="share-buttons">
                <button class="share-button" id="copy-link" data-clipboard-text="https://장형석남채린결혼합니다.메인.한국">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" height="24" width="24">
                        <path fill-rule="evenodd" d="M12.586 4.586a2 2 0 112.828 2.828l-3 3a2 2 0 01-2.828 0 1 1 0 00-1.414 1.414 4 4 0 005.656 0l3-3a4 4 0 00-5.656-5.656l-1.5 1.5a1 1 0 101.414 1.414l1.5-1.5zm-5 5a2 2 0 012.828 0 1 1 0 101.414-1.414 4 4 0 00-5.656 0l-3 3a4 4 0 105.656 5.656l1.5-1.5a1 1 0 10-1.414-1.414l-1.5 1.5a2 2 0 11-2.828-2.828l3-3z" clip-rule="evenodd"></path>
                    </svg>
                    링크 주소 복사하기
                </button>
                <button class="share-button" id="kakao-share">
                    <svg id="Bold" enable-background="new 0 0 24 24" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg" fill="currentColor">
                        <path d="m9.462 9.306-.692 1.951h1.383z"></path>
                        <path d="m12 1c-6.627 0-12 4.208-12 9.399 0 3.356 2.246 6.301 5.625 7.963-1.299 4.45-1.333 4.47-1.113 4.599.276.161.634-.005 5.357-3.311.692.097 1.404.148 2.131.148 6.627 0 12-4.208 12-9.399s-5.373-9.399-12-9.399zm-5.942 12.023c0 .362-.311.657-.692.657s-.692-.295-.692-.657v-4.086h-1.08c-.375 0-.679-.302-.679-.673s.303-.674.678-.674h3.545c.375 0 .679.302.679.673s-.305.674-.679.674h-1.08zm5.378.648c-.72 0-.587-.565-.919-1.195h-2.111c-.329.625-.2 1.195-.919 1.195-.693.001-.815-.421-.604-1.071l1.656-4.33c.117-.33.471-.669.922-.679.452.01.807.349.923.679 1.093 3.39 2.654 5.402 1.052 5.401zm3.939-.092h-2.221c-1.159 0-.454-1.565-.663-5.301 0-.379.317-.688.707-.688s.707.308.707.688v4.04h1.471c.366 0 .663.283.663.63-.001.348-.298.631-.664.631zm5.419-.518c-.025.181-.122.344-.269.454-.955.721-1.661-1.381-2.593-2.271l-.24.239v1.5c0 .38-.31.688-.693.688-.382 0-.692-.308-.692-.688v-4.705c0-.379.31-.688.692-.688s.692.308.692.688v1.478c1.277-.958 1.985-2.67 2.792-1.869.792.786-.848 1.474-1.527 2.422 1.604 2.212 1.909 2.267 1.838 2.752z"></path>
                    </svg>
                    카카오톡 공유하기
                </button>
            </div>
            <div class="copyright">Copyright 2024, <span class="name">형석 그리고 채린</span>. All rights reserved.</div>
        </div>
    </div>
</body>
<script type="module">
    function convertNewlinesToBr(text) {
        return text.replace(/\n/g, '<br>'); // \n을 <br>로 변환
    }

    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getFirestore, collection, getDocs, deleteDoc, doc, getDoc, updateDoc, Timestamp, addDoc, query, orderBy } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";
    // https://firebase.google.com/docs/web/setup#available-libraries
  
    // Your web app's Firebase configuration
    const firebaseConfig = {
        apiKey: "AIzaSyAmL6UFOg1Ne_LPepPlJAW_9a6kktjI4v0",
        authDomain: "wedding-comments-bafe4.firebaseapp.com",
        projectId: "wedding-comments-bafe4",
        storageBucket: "wedding-comments-bafe4.firebasestorage.app",
        messagingSenderId: "257449109138",
        appId: "1:257449109138:web:231ceda7f2aeaa4929284b"
    };
  
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app); // Firestore를 전역으로 설정

    // 방명록 메시지 로드
    async function loadGuestbookEntries() {
        const entriesContainer = document.querySelector('.guestbook-entries');
        entriesContainer.innerHTML = ''; // 기존 메시지 초기화

        // Firestore에서 최신순으로 정렬하여 데이터 가져오기
        const q = query(collection(db, 'guestbook'), orderBy('date', 'desc'));
        const querySnapshot = await getDocs(q);

        querySnapshot.forEach((doc) => {
            const entry = doc.data();
            const entryElement = document.createElement('div');
            entryElement.className = 'guestbook-entry';
            entryElement.innerHTML = `
                <div class="entry-header">
                    <span>${entry.name}</span>
                    <div class="entry-buttons">
                        <button class="edit-button" data-id="${doc.id}">수정</button>
                        <button class="delete-button" data-id="${doc.id}">삭제</button>
                    </div>
                </div>
                <p class="entry-message">${convertNewlinesToBr(entry.message)}</p>
            `;
            entriesContainer.appendChild(entryElement);
        });

        // attachButtonHandlers(); // 버튼 이벤트 핸들러 연결
    }

    // 초기 로드
    loadGuestbookEntries();

    document.addEventListener('DOMContentLoaded', () => {
        const guestbookModal = document.getElementById('guestbook-modal'); // 메시지 추가 모달
        const passwordModal = document.getElementById('password-modal');  // 비밀번호 확인 모달
        const editModal = document.getElementById('edit-modal');          // 메시지 수정 모달

        const guestbookForm = document.getElementById('guestbook-form');  // 메시지 추가 폼
        const passwordForm = document.getElementById('password-form');    // 비밀번호 확인 폼
        const editForm = document.getElementById('edit-form');            // 메시지 수정 폼
        const passwordInput = document.getElementById('password-input');  // 비밀번호 입력 필드
        const editMessageInput = document.getElementById('edit-message'); // 수정 메시지 입력 필드

        const addMessageButton = document.querySelector('.add-message-button'); // 메시지 추가 버튼

        let currentDocId = null; // 현재 수정 또는 삭제 대상 문서 ID
        let isEditMode = false;  // 수정인지 삭제인지 구분 플래그

        // 공통 모달 열기/닫기 함수
        function openModal(modal) {
            document.querySelectorAll('.modal').forEach(m => (m.style.display = 'none')); // 다른 모달 닫기
            modal.style.display = 'flex';
        }

        function closeModal(modal) {
            modal.style.display = 'none';
        }

        // 닫기 버튼 및 외부 클릭으로 모든 모달 닫기
        document.querySelectorAll('.close-button').forEach(button => {
            button.addEventListener('click', () => {
                closeModal(button.closest('.modal'));
            });
        });

        window.addEventListener('click', (event) => {
            if (event.target.classList.contains('modal')) {
                closeModal(event.target);
            }
        });

        // 메시지 추가 모달 열기
        addMessageButton.addEventListener('click', () => {
            openModal(guestbookModal); // 입력 모달만 열기
        });

        // 메시지 추가 처리
        guestbookForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const name = document.getElementById('name').value;
            const password = document.getElementById('password').value;
            const message = document.getElementById('message').value;

            try {
                const hashedPassword = await hashPassword(password);

                // Firestore에 데이터 추가
                await addDoc(collection(db, 'guestbook'), {
                    name,
                    password: hashedPassword,
                    message,
                    date: Timestamp.fromDate(new Date())
                });

                guestbookForm.reset(); // 폼 초기화
                closeModal(guestbookModal); // 모달 닫기
                await loadGuestbookEntries(); // 방명록 갱신
            } catch (error) {
                console.error('Error saving message:', error);
                showt('메시지 저장 중 오류가 발생했습니다.');
            }
        });

        // 삭제 버튼 클릭 시 비밀번호 확인 모달 열기
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-button')) {
                currentDocId = e.target.dataset.id;
                isEditMode = false; // 삭제 모드
                openModal(passwordModal); // 비밀번호 확인 모달 열기
            }
        });

        // 수정 버튼 클릭 시 비밀번호 확인 모달 열기
        document.addEventListener('click', async (e) => {
            if (e.target.classList.contains('edit-button')) {
                currentDocId = e.target.dataset.id;
                isEditMode = true; // 수정 모드
                openModal(passwordModal); // 비밀번호 확인 모달 열기
            }
        });

        // 비밀번호 확인 처리
        passwordForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const docSnap = await getDoc(doc(db, 'guestbook', currentDocId));
            if (docSnap.exists() && await verifyPassword(passwordInput.value, docSnap.data().password)) {
                closeModal(passwordModal); // 비밀번호 확인 모달 닫기
                passwordInput.value = ''; // 비밀번호 입력 초기화

                if (isEditMode) {
                    // 수정 모드인 경우 수정 모달 열기
                    editMessageInput.value = docSnap.data().message;
                    openModal(editModal);
                } else {
                    // 삭제 모드인 경우 삭제 진행
                    await deleteDoc(doc(db, 'guestbook', currentDocId));
                    showToast('메시지가 삭제되었습니다.');
                    loadGuestbookEntries(); // 방명록 갱신
                }
            } else {
                showToast('비밀번호가 일치하지 않습니다.');
            }
        });

        // 메시지 수정 처리
        editForm.addEventListener('submit', async (e) => {
            e.preventDefault();

            const newMessage = editMessageInput.value;
            await updateDoc(doc(db, 'guestbook', currentDocId), { message: newMessage });
            showToast('메시지가 수정되었습니다.');
            closeModal(editModal); // 수정 모달 닫기
            loadGuestbookEntries(); // 방명록 갱신
        });
    });



    async function verifyPassword(inputPassword, hashedPassword) {
        const hashedInputPassword = await hashPassword(inputPassword);
        return hashedInputPassword === hashedPassword;
    }
</script>
</html>